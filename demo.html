<!DOCTYPE html>
<html>
<head>
  <script src="vendor/underscore.js"></script>
  <script src="vendor/jquery.js"></script>
  <script src="vendor/backbone.js"></script>
  <script src="stuff/jquery.event.drag-1.5.js"></script>
  <script src="stuff/jquery.event.drop-1.1.js"></script>
  <script src="lib/backbone-file-editor.js"></script>
  <script src="demo/demo.js"></script>

  <link type="text/css" rel="stylesheet" media="all" href="css/backbone-file-explorer.css" />
  <link type="text/css" rel="stylesheet" media="all" href="demo/css/style.css" />
</head>

<body>
  <div id='explorer' class='explorer'></div>

  <p>
    <a id='updateLink' href='#'>Simulate an update via AJAX to delete file.png</a>
  </p>

  <div id='message'></div>
</body>

<script>
$(document).ready(function() {
  var fileExplorer = demo();

  // add drag-and-drop functionality
  startY = {};

  function dragHandler(event) {
    var id = $(this).attr('id');
    if (startY[id] == undefined) {
      var offsets = $(this).offset();
      startY[id] = offsets.top;
    }
    $(this).css({'z-index': 1});
    var offsets = $(this).offset();
    $(this).css({top: event.offsetY - startY[id]});
  }

  function dropHandler(event) {
    var droppedId   = event.dragTarget.id;
    var containerId = event.dropTarget.id;
    if (droppedId != containerId) {
      fileExplorer.busy();
      $('#message').text(
        'Dropped ID ' + droppedId + ' onto ' + containerId
      );
      setTimeout(function() {
        fileExplorer.idle();
        $('#message').text('');
      }, 2000);
    }
    $('#' + droppedId).css({top: 0});
  }

  $('.directory:not(:first)').bind('drag', dragHandler);
  $('.directory:not(:first)').bind('drop', dropHandler);
});
</script>

<script type="text/template" id='template-dir-level'>
  <div class="level"></div>
</script>

<script type="text/template" id='template-dir-entry'>
  <div style='clear:both'>
    <span class="directory_icon_button"></span>
    <span class="template_dir_entry_name"><%= name %></span>
    <span class="template_dir_entry_actions"></span>
  </div>
</script>

</html>
